name: Java CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:

      - name: Set up JDK 8
        uses: actions/setup-java@v2
        with:
          java-version: '8'
          distribution: 'adopt'

      #checkout vanilla theme from master
      - uses: actions/checkout@v2
        with:
          ref: "master"
          path: theme

      #checkout also this branch
      - uses: actions/checkout@v2
        with:
          path: override

      - name: Override (copy) configuration
        run: cp override/configuration.json theme/src/main/resources/configuration.json

      - name: Build with Maven
        run: cd theme && mvn --batch-mode --update-snapshots verify

#      - name: Copy built jar to release folder
#        run: mkdir release && cp theme/target/*jar release/

      - uses: actions/upload-artifact@v2
        with:
          name: 'keycloak-theme-vanilla-'${{ github.ref }}
          path: theme/target/*jar
          retention-days: 1
      
